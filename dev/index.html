<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>DEMetropolis Documentation · Differential Evolution Metropolis</title><meta name="title" content="DEMetropolis Documentation · Differential Evolution Metropolis"/><meta property="og:title" content="DEMetropolis Documentation · Differential Evolution Metropolis"/><meta property="twitter:title" content="DEMetropolis Documentation · Differential Evolution Metropolis"/><meta name="description" content="Documentation for Differential Evolution Metropolis."/><meta property="og:description" content="Documentation for Differential Evolution Metropolis."/><meta property="twitter:description" content="Documentation for Differential Evolution Metropolis."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>Differential Evolution Metropolis</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>DEMetropolis Documentation</a><ul class="internal"><li><a class="tocitem" href="#Next-Steps"><span>Next Steps</span></a></li><li><a class="tocitem" href="#Contents"><span>Contents</span></a></li><li><a class="tocitem" href="#Functions"><span>Functions</span></a></li><li><a class="tocitem" href="#Index"><span>Index</span></a></li></ul></li><li><a class="tocitem" href="tutorial/">Sampling from multimodal distributions</a></li><li><a class="tocitem" href="custom/">Customizing your sampler</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>DEMetropolis Documentation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>DEMetropolis Documentation</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/GBarnsley/DEMetropolis.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/GBarnsley/DEMetropolis.jl/blob/main/docs/src/index.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="DEMetropolis-Documentation"><a class="docs-heading-anchor" href="#DEMetropolis-Documentation">DEMetropolis Documentation</a><a id="DEMetropolis-Documentation-1"></a><a class="docs-heading-anchor-permalink" href="#DEMetropolis-Documentation" title="Permalink"></a></h1><p>Tools for sampling from log-densities using differential evolution algorithms.</p><p>See <a href="tutorial/#Sampling-from-multimodal-distributions">Sampling from multimodal distributions</a> and <a href="custom/#Customizing-your-sampler">Customizing your sampler</a> to get started.</p><p>This package is built upon <a href="https://www.tamaspapp.eu/LogDensityProblems.jl">LogDensityProblems.jl</a> so log-densities should be constructed using that package, and can be used with <a href="https://github.com/tpapp/TransformVariables.jl">TransformVariables.jl</a> to control the parameter space.</p><p>The other key dependency is <a href="https://juliastats.org/Distributions.jl">Distributions.jl</a>. Almost every parameter in proposals given here (see <a href="#Proposal-Distributions">Proposal Distributions</a>) are defined via customizable univariate distributions. Values that are fixed are specified via a <a href="https://en.wikipedia.org/wiki/Dirac_delta_function">Dirac distribution</a>, though in the API these can be specified with any real value. As a <em>warning</em> there are minimal checks on the given distributions, it is up to the user to ensure that they are suitable for the given parameter, i.e. there is nothing stopping you from having the noise term in the deMC proposal be centred around 100 instead of 0, or have the distribution for a probability be &gt; 1. Distributions can optionally be used to define your log-density, as in the examples given here. </p><p>As far as I am aware, there is one other package that implements differential evolution MCMC in Julia, <a href="https://github.com/itsdfish/DifferentialEvolutionMCMC.jl/tree/master">DifferentialEvolutionMCMC.jl</a>. I opted to implement my own version as I wanted a more flexible API and the subsampling scheme from DREAM. That&#39;s not to discredit DifferentialEvolutionMCMC.jl, it has many features this package does not, such as being able to work on optimization problems and parameter blocking.</p><h2 id="Next-Steps"><a class="docs-heading-anchor" href="#Next-Steps">Next Steps</a><a id="Next-Steps-1"></a><a class="docs-heading-anchor-permalink" href="#Next-Steps" title="Permalink"></a></h2><p>A few plans for this package, feel free to suggest features or improvements via <a href="https://github.com/GBarnsley/DEMetropolis/issues">issues</a>:</p><ul><li>Implement multi-try and delayed rejection DREAM, I avoided these so far since I have been using these samplers for costly log-densities with relatively few parameters, such as one that solve an ODE.</li><li>Integrate with AbstractMCMC and MCMCChains, potentially not worth the cost since parrallelism in a deMCMC is within chains rather than across chains.</li></ul><h2 id="Contents"><a class="docs-heading-anchor" href="#Contents">Contents</a><a id="Contents-1"></a><a class="docs-heading-anchor-permalink" href="#Contents" title="Permalink"></a></h2><ul><li><a href="custom/#Customizing-your-sampler">Customizing your sampler</a></li><li class="no-marker"><ul><li><a href="custom/#Custom-Stopping-Criteria">Custom Stopping Criteria</a></li><li><a href="custom/#Custom-Diagnostic-Checks">Custom Diagnostic Checks</a></li><li><a href="custom/#Custom-Proposal-Distributions">Custom Proposal Distributions</a></li><li><a href="custom/#Example:-Using-Custom-Components">Example: Using Custom Components</a></li></ul></li><li><a href="#DEMetropolis-Documentation">DEMetropolis Documentation</a></li><li class="no-marker"><ul><li><a href="#Next-Steps">Next Steps</a></li><li><a href="#Contents">Contents</a></li><li><a href="#Functions">Functions</a></li><li><a href="#Index">Index</a></li></ul></li><li><a href="tutorial/#Sampling-from-multimodal-distributions">Sampling from multimodal distributions</a></li><li class="no-marker"><ul><li><a href="tutorial/#Multimodal-Distributions">Multimodal Distributions</a></li><li><a href="tutorial/#Sampling-with-DEMetropolis">Sampling with DEMetropolis</a></li><li><a href="tutorial/#Custom-Scheme">Custom Scheme</a></li><li><a href="tutorial/#Interpreting-Results">Interpreting Results</a></li></ul></li></ul><h2 id="Functions"><a class="docs-heading-anchor" href="#Functions">Functions</a><a id="Functions-1"></a><a class="docs-heading-anchor-permalink" href="#Functions" title="Permalink"></a></h2><h3 id="Implemented-Sampling-Schemes"><a class="docs-heading-anchor" href="#Implemented-Sampling-Schemes">Implemented Sampling Schemes</a><a id="Implemented-Sampling-Schemes-1"></a><a class="docs-heading-anchor-permalink" href="#Implemented-Sampling-Schemes" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DEMetropolis.deMC" href="#DEMetropolis.deMC"><code>DEMetropolis.deMC</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Run the Differential Evolution Markov Chain (DE-MC) sampler proposed by ter Braak (2006)</p><p>This sampler uses the <code>de_update</code> step. It can optionally switch between two <code>γ</code> values (<code>γ₁</code> and <code>γ₂</code>) with probability <code>p_γ₂</code>. This is so that the sampler can occasionally move between modes, by having <code>γ₂ = 1</code> while γ₁ remains the optimal value based on the dimension of the problem.</p><p>This algorithm varies slightly from the original. Updates within a population occur on the previous position of that population. i.e. if chain 1 has been updated (a₁ → a₂) and chain 2 picks chain 1 to update from, then the value of chain 1 used by chain 2 is the pre-update version of chain 1 (a₁). This change allows the algorithm to be easily parallelised.</p><p>See doi.org/10.1007/s11222-006-8769-1 for more information on sampler.</p><p><strong>Arguments</strong></p><ul><li><code>ld</code>: The log-density function to sample from, intended to be a LogDensityProblem.</li><li><code>n_its</code>: The number of sampling iterations per chain.</li></ul><p><strong>Keyword Arguments</strong></p><ul><li><code>n_burnin</code>: Number of burn-in iterations. Defaults to <code>n_its * 5</code>.</li><li><code>n_chains</code>: Number of chains. Defaults to <code>dimension(ld) * 2</code>.</li><li><code>initial_state</code>: Initial states for the chains. Defaults to <code>randn(rng, n_chains, dimension(ld))</code>.</li><li><code>N₀</code>: Size of the initial population (must be &gt;= n<em>chains + 3), only used if using memory-based sampling. Defaults to `n</em>chains * 2`.</li><li><code>memory</code>: Use memory-based sampling (<code>true</code>) or memoryless (<code>false</code>). Defaults to <code>false</code>.</li><li><code>save_burnt</code>: Save burn-in samples. Defaults to <code>false</code>.</li><li><code>parallel</code>: Run chains in parallel. Defaults to <code>false</code>.</li><li><code>rng</code>: Random number generator. Defaults to <code>default_rng()</code>.</li><li><code>diagnostic_checks</code>: Diagnostic checks to run during burn-in. Defaults to <code>nothing</code>.</li><li><code>check_epochs</code>: Splits <code>n_burnin</code> into <code>check_epochs + 1</code> epochs and applies the diagnostic checks at the end of each epoch, other than the final epoch. Defaults to 1.</li><li><code>thin</code>: Thinning interval. Defaults to 1.</li><li><code>γ₁</code>: Primary scaling factor for DE update. Defaults to <code>2.38 / sqrt(2 * dim)</code>.</li><li><code>γ₂</code>: Secondary scaling factor for DE update. Defaults to 1.0.</li><li><code>p_γ₂</code>: Probability of using <code>γ₂</code>. Defaults to 0.1.</li><li><code>β</code>: Noise distribution for DE update. Defaults to <code>Uniform(-1e-4, 1e-4)</code>.</li></ul><p><strong>Returns</strong></p><ul><li>A named tuple containing the samples, sampler scheme, and potentially burn-in samples.</li></ul><p><strong>Example</strong></p><pre><code class="language-julia-repl hljs">julia&gt; deMC(ld, 1000; n_chains = 10)</code></pre><p>See also <a href="#DEMetropolis.composite_sampler"><code>composite_sampler</code></a>, <a href="#DEMetropolis.deMCzs"><code>deMCzs</code></a>, <a href="#DEMetropolis.DREAMz"><code>DREAMz</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/GBarnsley/DEMetropolis.jl/blob/a3f14b71b2b0e19dea49b1ef3b1b533078da42cd/src/templates.jl#L32-L73">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DEMetropolis.deMCzs" href="#DEMetropolis.deMCzs"><code>DEMetropolis.deMCzs</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Run the Differential Evolution Markov Chain with snooker update and historic sampling (DE-MCzs) sampler proposed by ter Braak and Vrugt (2008).</p><p>This sampler runs until a <code>stopping_criteria</code> (default: Rhat of the last 50% of the chains is &lt;1.2) is met. The sampler can occasionally propose snooker updates which can sample areas away from the current chains. Combined with the adaptive memory-based sampling this sampler can efficiently sample from a problem where n_chains &lt; the dimension of the problem.</p><p>See: doi.org/10.1007/s11222-008-9104-9 for more information</p><p><strong>Arguments</strong></p><ul><li><code>ld</code>: The log-density function to sample from, intended to be a LogDensityProblem.</li><li><code>epoch_size</code>: The number of saved iterations per chain per epoch.</li></ul><p><strong>Keyword Arguments</strong></p><ul><li><code>warmup_epochs</code>: Number of warm-up epochs. Defaults to 5.</li><li><code>epoch_limit</code>: Maximum number of sampling epochs. Defaults to 20.</li><li><code>n_chains</code>: Number of chains. Defaults to <code>dimension(ld) * 2</code>.</li><li><code>N₀</code>: Size of the initial population (must be &gt;= n<em>chains + 3). Defaults to `n</em>chains * 2`.</li><li><code>initial_state</code>: Initial population state. Defaults to <code>randn(rng, N₀, dimension(ld))</code>.</li><li><code>memory</code>: Use memory based sampling? Defaults to <code>true</code>.</li><li><code>save_burnt</code>: Save warm-up samples. Defaults to <code>true</code>.</li><li><code>parallel</code>: Run chains in parallel with multithreading. Defaults to <code>false</code>.</li><li><code>rng</code>: Random number generator. Defaults to <code>default_rng()</code>.</li><li><code>diagnostic_checks</code>: Diagnostic checks during warm-up. Defaults to <code>nothing</code>.</li><li><code>stopping_criteria</code>: Criterion to stop sampling. Defaults to <code>R̂_stopping_criteria()</code>.</li><li><code>γ</code>: Scaling factor for the DE update. Defaults to <code>2.38 / sqrt(2 * dim)</code>.</li><li><code>γₛ</code>: Scaling factor for the Snooker update. Defaults to <code>2.38 / sqrt(2)</code>.</li><li><code>p_snooker</code>: Probability of using the Snooker update. Defaults to 0.1.</li><li><code>β</code>: Noise distribution for DE update. Defaults to <code>Uniform(-1e-4, 1e-4)</code>.</li><li><code>thin</code>: Thinning interval. Defaults to 10.</li></ul><p><strong>Returns</strong></p><ul><li>A named tuple containing the samples, sampler scheme, and potentially burn-in samples.</li></ul><p><strong>Example</strong></p><pre><code class="language-julia-repl hljs">julia&gt; deMCzs(ld, 1000; n_chains = 3)</code></pre><p>See also <a href="#DEMetropolis.composite_sampler"><code>composite_sampler</code></a>, <a href="#DEMetropolis.deMC"><code>deMC</code></a>, <a href="#DEMetropolis.DREAMz"><code>DREAMz</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/GBarnsley/DEMetropolis.jl/blob/a3f14b71b2b0e19dea49b1ef3b1b533078da42cd/src/templates.jl#L119-L158">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DEMetropolis.DREAMz" href="#DEMetropolis.DREAMz"><code>DEMetropolis.DREAMz</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Run the Differential Evolution Adaptive Metropolis (DREAMz) sampler</p><p>This sampler runs until a <code>stopping_criteria</code> (default: Rhat of the last 50% of the chains is &lt;1.2) is met. The sampler uses <code>subspace_sampling</code>, where the cross-over probability is adapted during the burn-in period. It can optionally switch between two <code>γ</code> values, so that γ₁ can be the optimal value (based on sampled parameters) and γ₂ can be some fixed value (i.e. 1) so that the sampler can switch modes. This sampler also checks for outlier chains (where the mean log-density falls outside the IQR) and replaces then with the position of the chain with the highest log-density. This step breaks detailed balance its not performed in the last epoch of the warm-up period.</p><p>By default this is a memory-based sampler (DREAMz). Setting <code>memory = false</code> makes this the DREAM sampler.</p><p>See doi.org/10.1515/IJNSNS.2009.10.3.273 for more info.</p><p><strong>Arguments</strong></p><ul><li><code>ld</code>: The log-density function to sample from, intended to be a LogDensityProblem.</li><li><code>epoch_size</code>: The number of saved iterations per chain per epoch.</li></ul><p><strong>Keyword Arguments</strong></p><ul><li><code>warmup_epochs</code>: Number of warm-up epochs. Defaults to 5. Crossover probabilities are adapted in this period.</li><li><code>epoch_limit</code>: Maximum number of sampling epochs. Defaults to 20.</li><li><code>n_chains</code>: Number of chains. Defaults to <code>dimension(ld) * 2</code>.</li><li><code>N₀</code>: Size of the initial population (must be &gt;= n<em>chains). Defaults to `n</em>chains<code>. Only the first</code>n_chains<code>will be used if</code>memory = false`.</li><li><code>initial_state</code>: Initial population state. Defaults to <code>randn(rng, N₀, dimension(ld))</code>.</li><li><code>memory</code>: Use memory-based sampling (<code>true</code>) or memoryless (<code>false</code>). Defaults to <code>true</code>.</li><li><code>save_burnt</code>: Save warm-up samples. Defaults to <code>true</code>.</li><li><code>parallel</code>: Run chains in parallel. Defaults to <code>false</code>.</li><li><code>rng</code>: Random number generator. Defaults to <code>default_rng()</code>.</li><li><code>diagnostic_checks</code>: Diagnostic checks during warm-up. Defaults to <code>[ld_check()]</code>.</li><li><code>stopping_criteria</code>: Criterion to stop sampling. Defaults to <code>R̂_stopping_criteria()</code>.</li><li><code>γ₁</code>: Primary scaling factor for subspace update. Defaults to <code>nothing</code> (uses <code>2.38 / sqrt(2 * δ * d)</code>). Can also be a <code>Real</code> value.</li><li><code>γ₂</code>: Secondary scaling factor for subspace update. Defaults to 1.0. Can also be a <code>Real</code> value</li><li><code>p_γ₂</code>: Probability of using <code>γ₂</code>. Defaults to 0.2.</li><li><code>n_cr</code>: Number of crossover probabilities to adapt if <code>cr₁</code>/<code>cr₂</code> are <code>nothing</code>. Defaults to 3.</li><li><code>cr₁</code>: Crossover probability distribution/value for <code>γ₁</code>. Defaults to <code>nothing</code> (adaptive). Can also be a <code>Real</code> value (&lt;1) or a <code>Distributions.UnivariateDistribution</code>, in either case it is not adapted.</li><li><code>cr₂</code>: Crossover probability distribution/value for <code>γ₂</code>. See above.</li><li><code>ϵ</code>: Additive noise distribution. Defaults to <code>Uniform(-1e-4, 1e-4)</code>.</li><li><code>e</code>: Multiplicative noise distribution. Defaults to <code>Normal(0.0, 1e-2)</code>.</li><li><code>δ</code>: Number of difference vectors distribution. Defaults to <code>DiscreteUniform(1, 3)</code>.</li><li><code>thin</code>: Thinning interval. Defaults to 1.</li></ul><p><strong>Returns</strong></p><ul><li>A named tuple containing the samples, sampler scheme, and potentially burn-in samples.</li></ul><p><strong>Example</strong></p><pre><code class="language-julia-repl hljs">julia&gt; DREAMz(ld, 1000; n_chains = 10)</code></pre><p>See also <a href="#DEMetropolis.composite_sampler"><code>composite_sampler</code></a>, <a href="#DEMetropolis.deMC"><code>deMC</code></a>, <a href="#DEMetropolis.deMCzs"><code>deMCzs</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/GBarnsley/DEMetropolis.jl/blob/a3f14b71b2b0e19dea49b1ef3b1b533078da42cd/src/templates.jl#L206-L254">source</a></section></article><h3 id="Tools-for-setting-up-your-own-sampler"><a class="docs-heading-anchor" href="#Tools-for-setting-up-your-own-sampler">Tools for setting up your own sampler</a><a id="Tools-for-setting-up-your-own-sampler-1"></a><a class="docs-heading-anchor-permalink" href="#Tools-for-setting-up-your-own-sampler" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DEMetropolis.setup_sampler_scheme" href="#DEMetropolis.setup_sampler_scheme"><code>DEMetropolis.setup_sampler_scheme</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Create a sampler scheme defining the update steps to be used in <code>composite_sampler</code>.</p><p>The update used in each iteration for each chain is randomly selected from the <code>updates</code> given here.</p><p><strong>Arguments</strong></p><ul><li><code>updates...</code>: One or more <code>update_struct</code> objects (e.g., created by <code>setup_de_update</code>, <code>setup_snooker_update</code>, <code>setup_subspace_sampling</code> or your own custom sampler).</li></ul><p><strong>Keyword Arguments</strong></p><ul><li><code>w</code>: A vector of weights corresponding to each update step. If <code>nothing</code>, updates are chosen with equal probability. Weights must be non-negative.</li></ul><p><strong>Examples</strong></p><pre><code class="language-julia-repl hljs"># only snooker updates
julia&gt; setup_sampler_scheme(setup_snooker_update())

# DE and Snooker
julia&gt; setup_sampler_scheme(setup_snooker_update(), setup_de_update())

# With weights, snookers 10% of the time
julia&gt; setup_sampler_scheme(setup_snooker_update(), setup_de_update(), w = [0.9, 0.1])</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/GBarnsley/DEMetropolis.jl/blob/a3f14b71b2b0e19dea49b1ef3b1b533078da42cd/src/sampler.jl#L19-L41">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DEMetropolis.composite_sampler" href="#DEMetropolis.composite_sampler"><code>DEMetropolis.composite_sampler</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Run a composite MCMC sampler for a fixed number of iterations.</p><p>For sampling with your own sampling scheme from <code>setup_sampling_scheme</code></p><p><strong>Arguments</strong></p><ul><li><code>ld</code>: The log-density function to sample from, intended to be a LogDensityProblem.</li><li><code>n_its</code>: The desired number of samples per chain.</li><li><code>n_chains</code>: The number of chains to run.</li><li><code>memory</code>: Boolean indicating whether to <em>sample from historic values</em> instead sampling from current chains.</li><li><code>initial_state</code>: An array containing the initial states for the chains and the initial population if <code>memory=true</code>.</li><li><code>sampler_scheme</code>: A <code>sampler_scheme_struct</code> defining the update steps to use.</li></ul><p><strong>Keyword Arguments</strong></p><ul><li><code>thin</code>: Thinning interval for storing samples. Defaults to 1. If using <code>memory</code> this also effects which samples are added to the memory.</li><li><code>save_burnt</code>: Boolean indicating whether to save burn-in samples. Defaults to <code>false</code>. Does not save thinned samples</li><li><code>rng</code>: Random number generator. Defaults to <code>default_rng()</code>.</li><li><code>n_burnin</code>: Number of burn-in iterations. Defaults to <code>n_its * 5</code>. Any adaptions occur over this period.</li><li><code>parallel</code>: Boolean indicating whether to run chains in parallel using multithreading. Defaults to <code>false</code>.</li><li><code>diagnostic_checks</code>: A vector of <code>diagnostic_check_struct</code> to run during burn-in. Defaults to <code>nothing</code>.</li><li><code>check_epochs</code>: Splits <code>n_burnin</code> into <code>check_epochs + 1</code> epochs and applies the diagnostic checks at the end of each epoch, other than the final epoch. Defaults to 1. </li></ul><p><strong>Returns</strong></p><ul><li>A named tuple containing the samples, sampler scheme, and potentially burn-in samples.</li></ul><p><strong>Example</strong></p><pre><code class="language-julia-repl hljs"># DE and Snooker sample scheme with memory
julia&gt; composite_sampler(
    ld, 1000, 10, true, initial_state, setup_sampler_scheme(setup_snooker_update(), setup_de_update())
)</code></pre><p>See also <a href="#DEMetropolis.deMC"><code>deMC</code></a>, <a href="#DEMetropolis.deMCzs"><code>deMCzs</code></a>, <a href="#DEMetropolis.DREAMz"><code>DREAMz</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/GBarnsley/DEMetropolis.jl/blob/a3f14b71b2b0e19dea49b1ef3b1b533078da42cd/src/sampler.jl#L95-L129">source</a></section><section><div><p>Run a composite MCMC sampler until a stopping criterion is met.</p><p>For sampling with your own sampling scheme from <code>setup_sampling_scheme</code>.</p><p><strong>Arguments</strong></p><ul><li><code>ld</code>: The log-density function to sample from, intended to be a LogDensityProblem.</li><li><code>epoch_size</code>: The number of saved iterations per chain per epoch.</li><li><code>n_chains</code>: The number of chains to run.</li><li><code>memory</code>: Boolean indicating whether to <em>sample from historic values</em> instead sampling from current chains.</li><li><code>initial_state</code>: An array containing the initial states for the chains and the initial population if <code>memory==true</code>.</li><li><code>sampler_scheme</code>: A <code>sampler_scheme_struct</code> defining the update steps to use.</li><li><code>stopping_criteria</code>: A <code>stopping_criteria_struct</code> defining when to stop sampling.</li></ul><p><strong>Keyword Arguments</strong></p><ul><li><code>thin</code>: Thinning interval for storing samples. Defaults to 1. If using <code>memory</code> this also effects which samples are added to the memory.</li><li><code>save_burnt</code>: Boolean indicating whether to save burn-in samples. Defaults to <code>false</code>. Does not save thinned samples.</li><li><code>rng</code>: Random number generator. Defaults to <code>default_rng()</code>.</li><li><code>warmup_epochs</code>: Number of warm-up epochs before we begin checking the stopping criteria. Defaults to 5. Samples from these epochs won&#39;t be included in the final sample. Sampler adaptation only occurs in this period.</li><li><code>parallel</code>: Boolean indicating whether to run chains in parallel using multithreading. Defaults to <code>false</code>.</li><li><code>epoch_limit</code>: Maximum number of sampling epochs to run. Defaults to 20.</li><li><code>diagnostic_checks</code>: A vector of <code>diagnostic_check_struct</code> to run during warm-up. Defaults to <code>nothing</code>.</li></ul><p><strong>Returns</strong></p><ul><li>A named tuple containing the samples, sampler scheme, and potentially burn-in samples.</li></ul><p><strong>Example</strong></p><pre><code class="language-julia-repl hljs"># DE and Snooker sample scheme with memory until Rhat ≤ 1.05
julia&gt; composite_sampler(
    ld, 1000, 10, true, initial_state, setup_sampler_scheme(setup_snooker_update(), setup_de_update()), R̂_stopping_criteria(1.05)
)</code></pre><p>See also <a href="#DEMetropolis.deMC"><code>deMC</code></a>, <a href="#DEMetropolis.deMCzs"><code>deMCzs</code></a>, <a href="#DEMetropolis.DREAMz"><code>DREAMz</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/GBarnsley/DEMetropolis.jl/blob/a3f14b71b2b0e19dea49b1ef3b1b533078da42cd/src/sampler.jl#L183-L218">source</a></section></article><h3 id="Proposal-Distributions"><a class="docs-heading-anchor" href="#Proposal-Distributions">Proposal Distributions</a><a id="Proposal-Distributions-1"></a><a class="docs-heading-anchor-permalink" href="#Proposal-Distributions" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DEMetropolis.setup_de_update" href="#DEMetropolis.setup_de_update"><code>DEMetropolis.setup_de_update</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Set up a Differential Evolution (DE) update step.</p><p>See doi.org/10.1007/s11222-006-8769-1 for more information.</p><p><strong>Arguments</strong></p><ul><li><code>ld</code>: The log-density function (used to determine dimension if <code>γ</code> is not provided).</li></ul><p><strong>Keyword Arguments</strong></p><ul><li><code>γ</code>: The scaling factor for the difference vector. Can be a <code>Real</code>, a <code>Distributions.UnivariateDistribution</code>, or <code>nothing</code>. If <code>nothing</code>, it defaults based on <code>deterministic_γ</code> and the problem dimension.</li><li><code>β</code>: Distribution for the small noise term added to the proposal. Defaults to <code>Uniform(-1e-4, 1e-4)</code>.</li><li><code>deterministic_γ</code>: If <code>true</code> and <code>γ</code> is <code>nothing</code>, sets <code>γ</code> to the theoretically optimal <code>2.38 / sqrt(2 * dim)</code>. If <code>false</code>, sets <code>γ</code> to <code>Uniform(0.8, 1.2)</code>. Defaults to <code>true</code>.</li></ul><p><strong>Example</strong></p><pre><code class="language-julia-repl hljs">julia&gt; setup_de_update(ld; β = Normal(0.0, 0.01))</code></pre><p>See also <a href="#DEMetropolis.setup_snooker_update"><code>setup_snooker_update</code></a>, <a href="#DEMetropolis.setup_subspace_sampling"><code>setup_subspace_sampling</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/GBarnsley/DEMetropolis.jl/blob/a3f14b71b2b0e19dea49b1ef3b1b533078da42cd/src/updates.jl#L12-L30">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DEMetropolis.setup_snooker_update" href="#DEMetropolis.setup_snooker_update"><code>DEMetropolis.setup_snooker_update</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Set up a Snooker update step.</p><p>See doi.org/10.1007/s11222-008-9104-9 for more information.</p><p><strong>Keyword Arguments</strong></p><ul><li><code>γ</code>: The scaling factor for the projection. Can be a <code>Real</code>, a <code>Distributions.UnivariateDistribution</code>, or <code>nothing</code>. If <code>nothing</code>, it defaults based on <code>deterministic_γ</code>.</li><li><code>deterministic_γ</code>: If <code>true</code> and <code>γ</code> is <code>nothing</code>, sets <code>γ</code> to the theoretically optimal <code>2.38 / sqrt(2)</code>. If <code>false</code>, sets <code>γ</code> to <code>Uniform(0.8, 1.2)</code>. Defaults to <code>true</code>.</li></ul><p><strong>Example</strong></p><pre><code class="language-julia-repl hljs">julia&gt; setup_snooker_update(γ = Uniform(0.1, 2.0))</code></pre><p>See also <a href="#DEMetropolis.setup_de_update"><code>setup_de_update</code></a>, <a href="#DEMetropolis.setup_subspace_sampling"><code>setup_subspace_sampling</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/GBarnsley/DEMetropolis.jl/blob/a3f14b71b2b0e19dea49b1ef3b1b533078da42cd/src/updates.jl#L68-L82">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DEMetropolis.setup_subspace_sampling" href="#DEMetropolis.setup_subspace_sampling"><code>DEMetropolis.setup_subspace_sampling</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Set up a Subspace Sampling (DREAM-like) update step.</p><p>See doi.org/10.1515/IJNSNS.2009.10.3.273 for more information.</p><p><strong>Keyword Arguments</strong></p><ul><li><code>γ</code>: Fixed scaling factor for the difference vector sum. If <code>nothing</code> (default), uses <code>2.38 / sqrt(2 * δ * d)</code> where <code>d</code> is the number of updated dimensions. If a <code>Real</code> is provided, uses that fixed value.</li><li><code>cr</code>: Crossover probability. Can be a <code>Real</code> (fixed probability), <code>nothing</code> (adaptive probability using <code>n_cr</code> values), or a <code>Distributions.UnivariateDistribution</code>. Defaults to <code>nothing</code>.</li><li><code>n_cr</code>: Number of crossover probabilities to adapt between if <code>cr</code> is <code>nothing</code>. Defaults to 3.</li><li><code>δ</code>: Number of difference vectors to add. Can be an <code>Integer</code> or a <code>Distributions.DiscreteUnivariateDistribution</code>. Defaults to <code>DiscreteUniform(1, 3)</code>.</li><li><code>ϵ</code>: Distribution for small noise added to the proposal in the selected subspace. Defaults to <code>Uniform(-1e-4, 1e-4)</code>.</li><li><code>e</code>: Distribution for multiplicative noise (<code>e + 1</code>) applied to the difference vector sum. Defaults to <code>Normal(0.0, 1e-2)</code>.</li></ul><p><strong>Example</strong></p><pre><code class="language-julia-repl hljs">julia&gt; setup_subspace_sampling(cr = Beta(1, 2))</code></pre><p>See also <a href="#DEMetropolis.setup_de_update"><code>setup_de_update</code></a>, <a href="#DEMetropolis.setup_snooker_update"><code>setup_snooker_update</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/GBarnsley/DEMetropolis.jl/blob/a3f14b71b2b0e19dea49b1ef3b1b533078da42cd/src/updates.jl#L149-L167">source</a></section></article><h3 id="Stopping-Criteria"><a class="docs-heading-anchor" href="#Stopping-Criteria">Stopping Criteria</a><a id="Stopping-Criteria-1"></a><a class="docs-heading-anchor-permalink" href="#Stopping-Criteria" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DEMetropolis.R̂_stopping_criteria" href="#DEMetropolis.R̂_stopping_criteria"><code>DEMetropolis.R̂_stopping_criteria</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Create a stopping criterion based on the rank Gelman-Rubin diagnostic (R̂). Sampling stops when the R̂ value for all parameters is below <code>maximum_R̂</code>.</p><p><strong>Arguments</strong></p><ul><li><code>maximum_R̂</code>: The maximum acceptable R̂ value. Defaults to 1.2.</li></ul><p>See also <a href="https://turinglang.org/MCMCDiagnosticTools.jl/stable/#MCMCDiagnosticTools.rhat"><code>MCMCDiagnosticTools.rhat</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/GBarnsley/DEMetropolis.jl/blob/a3f14b71b2b0e19dea49b1ef3b1b533078da42cd/src/stopping.jl#L3-L10">source</a></section></article><h3 id="Diagnostics-Checks-with-Resampling"><a class="docs-heading-anchor" href="#Diagnostics-Checks-with-Resampling">Diagnostics Checks with Resampling</a><a id="Diagnostics-Checks-with-Resampling-1"></a><a class="docs-heading-anchor-permalink" href="#Diagnostics-Checks-with-Resampling" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DEMetropolis.ld_check" href="#DEMetropolis.ld_check"><code>DEMetropolis.ld_check</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Create a diagnostic check that identifies outlier chains based on their mean log-density (of the last 50% of the chain) during burn-in/warm-up. Outlier chains (those with mean log-density below Q1 - 2*IQR) are reset to the state of the chain with the highest mean log-density.</p><p>See: Vrugt 2009 doi.org/10.1515/IJNSNS.2009.10.3.273</p><p>See also <a href="#DEMetropolis.acceptance_check"><code>acceptance_check</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/GBarnsley/DEMetropolis.jl/blob/a3f14b71b2b0e19dea49b1ef3b1b533078da42cd/src/diagnostics.jl#L3-L10">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DEMetropolis.acceptance_check" href="#DEMetropolis.acceptance_check"><code>DEMetropolis.acceptance_check</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Create a diagnostic check that identifies poorly mixing chains based on their acceptance rate (of the last 50% of the chain) during burn-in/warm-up. Chains with acceptance rates below <code>min_acceptance</code> and significantly lower than others (based on log-acceptance rate IQR) are reset to the state of the chain closest to the <code>target_acceptance</code> rate.</p><p><strong>Arguments</strong></p><ul><li><code>min_acceptance</code>: The minimum acceptable acceptance rate. Defaults to 0.1.</li><li><code>target_acceptance</code>: The target acceptance rate used to select the best chain for resetting outliers. Defaults to 0.24.</li></ul><p>See also <a href="#DEMetropolis.ld_check"><code>ld_check</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/GBarnsley/DEMetropolis.jl/blob/a3f14b71b2b0e19dea49b1ef3b1b533078da42cd/src/diagnostics.jl#L35-L44">source</a></section></article><h2 id="Index"><a class="docs-heading-anchor" href="#Index">Index</a><a id="Index-1"></a><a class="docs-heading-anchor-permalink" href="#Index" title="Permalink"></a></h2><ul><li><a href="#DEMetropolis.R̂_stopping_criteria"><code>DEMetropolis.R̂_stopping_criteria</code></a></li><li><a href="#DEMetropolis.acceptance_check"><code>DEMetropolis.acceptance_check</code></a></li><li><a href="#DEMetropolis.ld_check"><code>DEMetropolis.ld_check</code></a></li><li><a href="#DEMetropolis.DREAMz"><code>DEMetropolis.DREAMz</code></a></li><li><a href="#DEMetropolis.composite_sampler"><code>DEMetropolis.composite_sampler</code></a></li><li><a href="#DEMetropolis.deMC"><code>DEMetropolis.deMC</code></a></li><li><a href="#DEMetropolis.deMCzs"><code>DEMetropolis.deMCzs</code></a></li><li><a href="#DEMetropolis.setup_de_update"><code>DEMetropolis.setup_de_update</code></a></li><li><a href="#DEMetropolis.setup_sampler_scheme"><code>DEMetropolis.setup_sampler_scheme</code></a></li><li><a href="#DEMetropolis.setup_snooker_update"><code>DEMetropolis.setup_snooker_update</code></a></li><li><a href="#DEMetropolis.setup_subspace_sampling"><code>DEMetropolis.setup_subspace_sampling</code></a></li></ul></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="tutorial/">Sampling from multimodal distributions »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Tuesday 26 August 2025 09:15">Tuesday 26 August 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
